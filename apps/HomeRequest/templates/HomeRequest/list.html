{% extends '_minbase.html' %}
{% load thaidate %}
{% load static %}

{% block title %}
รายการขอบ้านพัก
{% endblock %}

{% block scriptlink %}
    <script src="{% static 'my_script/modal-with-custom-action.js'%}"></script>
{% endblock %}


{% block script %}
<script>
    function modal_hr_detail(hr_id)
    {
        urltext = "{% url 'HomeRequest:md' 99999 %}"
        
        new_urltext = urltext.replace("99999",hr_id)
        console.log(new_urltext)
        fetch_show_modal(new_urltext);
    }

    function show_processstep(process_step)
    {
        var all_process_step = ['RP','RS','UP','US','PP','PA','GH','RC']
        all_process_step.forEach(function (item, index) {
            table_rows = document.getElementsByClassName(item);
            for (var i = 0; i < table_rows.length; i++) {
                if(process_step == 'ALL')
                {
                    table_rows.item(i).style.display = 'table-row';
                    document.getElementById("btn_show_all").style.display = 'none';
                }
                else if(item != process_step)
                {
                    document.getElementById("btn_show_all").style.display = 'inline';
                    table_rows.item(i).style.display = 'none';
                }
                else
                    table_rows.item(i).style.display = 'table-row';
            }
        });
    }

</script>
{% endblock %}

{% block style %}
  <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous"/>
  <style>
    .icon-size {font-size: 20px;}
    .check-size {font-size: 10px;}

    thead tr:first-child{
        text-align: center;
    }

    table td:not(:nth-child(6)):not(:last-child){
        text-align: center;
    }

    td a {
        font-size:smaller;
        text-decoration: none;
        color:green;
    }


  </style>
{% endblock %}

{% block header %}
รายการคำขอ {{ request.user.CurrentUnit}}
{% endblock %}

{% block header_right %}{{ request.user.FullName}}{% endblock %}

{% block CardRow %}
    <div class = "row">
        {% include "project/card.html" with bgcolor="bg-light" text_color="text-dark" awesome="fa-pen" number=hr.Num_RP text="เริ่มกรอก" click="show_processstep('RP');" %}  
        {% include "project/card.html" with bgcolor="bg-danger" text_color="text-white" awesome="fa-list" number=hr.Num_RS text="ส่งหน่วย" click="show_processstep('RS');"%}
        {% include "project/card.html" with bgcolor="bg-warning" text_color="text-white" awesome="fa-cog fa-spin" number=hr.Num_UP text="นขต.รับ" click="show_processstep('UP');"%}
        {% include "project/card.html" with bgcolor="bg-success" text_color="text-white" awesome="fa-check" number=hr.Num_US text="นขต.ส่ง" click="show_processstep('US');"%}
        {% include "project/card.html" with bgcolor="bg-secondary" text_color="text-white" awesome="fa-paperclip" number=hr.Num_PPPA text="กพ.รับเรื่อง" click="show_processstep('PP');"%}
        {% include "project/card.html" with bgcolor="bg-primary" text_color="text-white" awesome="fa-home" number=hr.Num_GH text="รับจัดสรร" click="show_processstep('GH');"%}
    </div> 
{% endblock %}

{% block content%}
    {% if not object_list %}
        <h3>ไม่มีข้าราชการส่งรายงานขอบ้านพักในระบบ</h3>
    {% else %}
    <div class="table-responsive">
        <div class="table-wrapper">
            <div class="table-title">
                <div class="row mb-2">
                    <div class="col-sm-8">
                        <a id = "btn_show_all" href = '#' onclick = "show_processstep('ALL');" type="button" class="btn btn-info" style="display: none"><i class="fa fa-list-ol"></i> แสดงทั้งหมด</a>
                    </div>
                    <div class="col-sm-4 text-end">
                        <a href = '{% url 'HomeRequest:xls' request.user.CurrentUnit.id%}' type="button" class="btn btn-success"><i class="fa fa-file-excel"></i> excel</a>
                        <a href = '{% url 'HomeRequest:doc_unit' request.user.CurrentUnit.id%}' type="button" class="btn btn-primary text-white"><i class="fa fa-file-word"></i> word</a>
                    </div>
                </div>
            </div>
            <table class="table table-bordered table-striped">
                    <col width="40">
                    <col width="40">
                    <col width="40">
                    <col width="40">
                    <col width="120">
                    <col width="330">
                    <col width="120">
                    <col width="90">
                    <col width="80">
                    <col width="60">
                    <col width="40">
                    <col width="40">
                    <col width="40">
                    <col width="200">
                <thead>
                    <tr>
                        <th>#</th>
                        <th colspan = "3">เอกสาร</th>

                        <th>วันส่ง</th>
                        <th>ยศ ชื่อ นามสกุล</th>
                        <th>สังกัด</th>
                        <th>Mobile</th>
                        <th>ผู้ขอ</th>
                        <th>นขต.</th>
                        <th>ประเมิน</th>                        
                        <th>กพ.ทอ.</th>
                        <th>อนุมัติ</th>
                        <th>หมายเหตุ</th>                        
                    </tr>
                </thead>
                <tbody>
                {% for object in object_list %}
                    {% include "HomeRequest/row_data/unit_row_data.html" with object=object%}
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}
{% endblock %}